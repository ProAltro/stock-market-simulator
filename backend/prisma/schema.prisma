generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x", "linux-musl"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String              @id @default(uuid())
  email        String              @unique
  passwordHash String              @map("password_hash")
  displayName  String?             @map("display_name")
  createdAt    DateTime            @default(now()) @map("created_at")
  submissions  AlgorithmSubmission[]

  @@map("users")
}

model AlgorithmSubmission {
  id              String     @id @default(uuid())
  userId          String     @map("user_id")
  language        String     // "python" or "cpp"
  code            String     @db.Text
  status          String     @default("pending") // pending, running, completed, failed
  finalNetWorth   Decimal?   @map("final_net_worth") @db.Decimal(20, 4)
  cashBalance     Decimal?   @map("cash_balance") @db.Decimal(20, 4)
  positions       Json?
  totalTrades     Int?       @map("total_trades")
  executionTimeMs Int?       @map("execution_time_ms")
  error           String?    @db.Text
  stdout          String?    @db.Text
  createdAt       DateTime   @default(now()) @map("created_at")
  completedAt     DateTime?  @map("completed_at")

  user            User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([finalNetWorth(sort: Desc)])
  @@index([userId])
  @@map("algorithm_submissions")
}
